"use strict";(self.webpackChunkmy_wiki=self.webpackChunkmy_wiki||[]).push([[9093],{5587:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"computers/programming/languages/kotlin","title":"Kotlin","description":"Better than Java in most cases.","source":"@site/docs/computers/programming/languages/kotlin.md","sourceDirName":"computers/programming/languages","slug":"/computers/programming/languages/kotlin","permalink":"/computers/programming/languages/kotlin","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"JavaScript","permalink":"/computers/programming/languages/javascript"},"next":{"title":"Python","permalink":"/computers/programming/languages/python"}}');var t=i(4848),r=i(8453);const l={},c="Kotlin",o={},a=[{value:"Links",id:"links",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components},{Details:i}=e;return i||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"kotlin",children:"Kotlin"})}),"\n",(0,t.jsx)(e.p,{children:"Better than Java in most cases."}),"\n",(0,t.jsx)(e.h2,{id:"links",children:"Links"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["YouTube:\n",(0,t.jsx)(e.a,{href:"https://youtu.be/_hfBv0a09Jc",children:"Introduction to Coroutines | Roman Elizarov"}),"\n(45:31)"]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"Notes"}),(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Async programming:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"We live in a world that need async programming"}),"\n",(0,t.jsx)(e.li,{children:"Threads: cannot handle a large amount of concurrent work"}),"\n",(0,t.jsx)(e.li,{children:"Callbacks: function being called when ready, but leads to callback hell"}),"\n",(0,t.jsx)(e.li,{children:"Futures/Promises/Rx: provides concise syntax, but many custom combinators"}),"\n",(0,t.jsx)(e.li,{children:"Kotlin design coroutines to solve these problems"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"suspend"}),":","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Marks a function as asynchronous"}),"\n",(0,t.jsx)(e.li,{children:"The function will suspend and return later"}),"\n",(0,t.jsx)(e.li,{children:"It hides the suspension points (no await)"}),"\n",(0,t.jsx)(e.li,{children:"Writing non-blocking code as if they are blocking code"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"Composition: take a suspendable lambda block as argument"}),"\n",(0,t.jsxs)(e.li,{children:["Coroutine Builders: to bridge the blocking and non-blocking world","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"launch"}),": fire and forget"]}),"\n",(0,t.jsx)(e.li,{children:"Coroutine context: specify which pool of threads to run on"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["Why not the ",(0,t.jsx)(e.code,{children:"async/await"}),"?","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Syntax wise, the differences are the additional ",(0,t.jsx)(e.code,{children:"async"})," and ",(0,t.jsx)(e.code,{children:"await"})," keywords"]}),"\n",(0,t.jsx)(e.li,{children:"And crucially, the return type is difference"}),"\n",(0,t.jsxs)(e.li,{children:["The return type is either ",(0,t.jsx)(e.code,{children:"Task<T>"})," or ",(0,t.jsx)(e.code,{children:"T"})]}),"\n",(0,t.jsx)(e.li,{children:"The problem is the concurrent and sequential behaviors are mixed"}),"\n",(0,t.jsxs)(e.li,{children:["Kotlin coroutines design to imitate sequential syntax, i.e. it always return ",(0,t.jsx)(e.code,{children:"T"}),", and concurrency (returning type ",(0,t.jsx)(e.code,{children:"Deferred<T>"}),") has to be explicit"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["Kotlin async function:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Define a non suspending function with the ",(0,t.jsx)(e.code,{children:"Async"})," suffix as a convension"]}),"\n",(0,t.jsxs)(e.li,{children:["This ",(0,t.jsx)(e.code,{children:"Async"})," function returns a future/deferred"]}),"\n",(0,t.jsxs)(e.li,{children:["Kotlin call the future/promise as ",(0,t.jsx)(e.code,{children:"Deferred"})]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"async"}),": another coroutine builder that return a deferred type"]}),"\n",(0,t.jsxs)(e.li,{children:["Then use ",(0,t.jsx)(e.code,{children:".await()"})," to wait for the result"]}),"\n",(0,t.jsxs)(e.li,{children:["Kotlin approach is to make the ",(0,t.jsx)(e.code,{children:"async"})," explicit to the user"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"Think of coroutines as very light-weighted threads, scaling in ways that threads cannot do"}),"\n",(0,t.jsxs)(e.li,{children:["Coroutine can interop with java using the ",(0,t.jsx)(e.code,{children:"future"})," coroutine builder"]}),"\n",(0,t.jsxs)(e.li,{children:["Beyond asynchronous programming, can use ",(0,t.jsx)(e.code,{children:"buildSequence"})," with suspend function and ",(0,t.jsx)(e.code,{children:"yield"})," to create iterators"]}),"\n"]})]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["YouTube:\n",(0,t.jsx)(e.a,{href:"https://youtu.be/YrrUCSi72E8",children:"Deep Dive into Coroutines on JVM | Romand Elizarov"}),"\n(45:17)"]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"Notes"}),(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Direct style:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Write the action and what happens after directly"}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:'Continuation: the "what happens after the action"'}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-kt",children:"fun postItem(item: Item) {\n  val token = requestToken() // action\n\n  // continuation\n  val post = createPost(token, item)\n  processPost(post)\n}\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Continuation passing style"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Pass the continuation as an argument, like callbacks","\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-kt",children:"fun postItem(item: Item) {\n  requestToken { token ->\n    // continuation\n    val post = createPost(token, item)\n    processPost(post)\n  }\n}\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"CPS transformation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Coroutines let you write continuation in direct style"}),"\n",(0,t.jsxs)(e.li,{children:["A suspend function is converted to the same function with an additional\n",(0,t.jsx)(e.code,{children:"Continuation"})," parameter"]}),"\n",(0,t.jsx)(e.li,{children:"Continuation is just a callback"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Some explanation to how suspend function is compiled"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Add labels to the code at each suspension point"}),"\n",(0,t.jsx)(e.li,{children:"Create a state machine that is a continuation"}),"\n",(0,t.jsx)(e.li,{children:"When a suspend function completes, it invokes the continuation"}),"\n",(0,t.jsx)(e.li,{children:"The state machine invoke the same parent suspend function with the updated\nstate"}),"\n",(0,t.jsx)(e.li,{children:"The execution flow jumps to the next label with the new states"}),"\n",(0,t.jsx)(e.li,{children:"State machine is better than callbacks because there are less closure and\nobject creation"}),"\n",(0,t.jsx)(e.li,{children:"Labels also make it easier to support loops and higher-order functions"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"suspendCoroutine"}),": implement ",(0,t.jsx)(e.code,{children:".await()"})," for function returning futures"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Can convert existing code that returns future to suspend functions"}),"\n",(0,t.jsx)(e.li,{children:"All futures have callbacks behind the scene, resume the continuation in\nthose callbacks"}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"suspendCoroutine { cont -> ... }"})," with ",(0,t.jsx)(e.code,{children:"cont.resume()"})," or\n",(0,t.jsx)(e.code,{children:"cont.resumeWithException()"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Coroutine context"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"When there was no context, the thread that the continuation runs depends\non where it was resumed from the previous action callbacks, e.g. where the\nretrofit thread pool invoke the callback"}),"\n",(0,t.jsx)(e.li,{children:"Continuation interceptor: resuming a continuation will submit a task to a\ndispatcher"}),"\n",(0,t.jsx)(e.li,{children:"Which can then intercept the resumption and executing on another thread"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"startCoroutine"}),": building coroutine builders"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Can convert suspend functions to return a specific custom future type"}),"\n",(0,t.jsxs)(e.li,{children:["Think of it as the opposite of ",(0,t.jsx)(e.code,{children:"suspendCoroutine"})]}),"\n",(0,t.jsx)(e.li,{children:"By implement the context and how this coroutine returns when resumed"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Job cancellation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"launch"})," returns a job, and job is part of the coroutine context"]}),"\n",(0,t.jsxs)(e.li,{children:["Job can be cancelled with ",(0,t.jsx)(e.code,{children:".cancel()"})," and joined with ",(0,t.jsx)(e.code,{children:".join()"})]}),"\n",(0,t.jsx)(e.li,{children:"Cancellation are cooperative in coroutines"}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"suspendCancellableCoroutine"}),": cancellable version that takes\n",(0,t.jsx)(e.code,{children:"invokeOnCancellation"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Communicating Sequential Processes (CSP)"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"A style of program to shift from shared mutable state to share by\ncommunicating"}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"val channel = Channel()"})," and ",(0,t.jsx)(e.code,{children:"channel.send()"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Actors:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"CSP uses named channels"}),"\n",(0,t.jsx)(e.li,{children:"Actors are named coroutines with an inbox channel"}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"val printer = actor { }"})," and ",(0,t.jsx)(e.code,{children:"printer.send()"})]}),"\n"]}),"\n"]}),"\n"]})]}),"\n"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>c});var s=i(6540);const t={},r=s.createContext(t);function l(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);