"use strict";(self.webpackChunkmy_wiki=self.webpackChunkmy_wiki||[]).push([[8596],{8747:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>h});var r=t(7349),i=t(4848),s=t(8453);const o={title:"My $4/month self-hosted web server setup",tags:[{label:"Computers",permalink:"computers"},{label:"Self Hosting",permalink:"self-host"}],toc_min_heading_level:2,toc_max_heading_level:2,authors:"ethan"},a=void 0,l={authorsImageUrls:[void 0]},h=[{value:"Overview",id:"overview",level:2},{value:"Why I chose self-hosting",id:"why-i-chose-self-hosting",level:3},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Register a Domain",id:"register-a-domain",level:2},{value:"Renting a Hetzner VPS",id:"renting-a-hetzner-vps",level:2},{value:"Where to host",id:"where-to-host",level:3},{value:"Hetzner Server Setup",id:"hetzner-server-setup",level:3},{value:"SSH Connection",id:"ssh-connection",level:3},{value:"Running the Web Server",id:"running-the-web-server",level:2},{value:"Why Docker?",id:"why-docker",level:3},{value:"Pull Code",id:"pull-code",level:3},{value:"Building the Server Image",id:"building-the-server-image",level:3},{value:"Running the Postgres Container",id:"running-the-postgres-container",level:3},{value:"Docker Volume",id:"docker-volume",level:4},{value:"Docker Network",id:"docker-network",level:4},{value:"Running the Database",id:"running-the-database",level:4},{value:"Verify the Database is Running",id:"verify-the-database-is-running",level:4},{value:"Running the Server Container",id:"running-the-server-container",level:3},{value:"Configuring DNS",id:"configuring-dns",level:2},{value:"Configure firewall (<code>ufw</code>)",id:"configure-firewall-ufw",level:2},{value:"Configure reverse proxy server (<code>nginx</code>)",id:"configure-reverse-proxy-server-nginx",level:2},{value:"Basics",id:"basics",level:3},{value:"HTTPS",id:"https",level:3},{value:"HTTP2 and HTTP3",id:"http2-and-http3",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"Netdata",id:"netdata",level:3},{value:"Checkly",id:"checkly",level:3},{value:"Much More",id:"much-more",level:2},{value:"Summary",id:"summary",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This blog documented my setup for self-hosting a web server. Hopefully this is\nhelpful for others to get started with hosting your web server. I was intimated\nby all the potential cost and complexity before, but after all, it was not that\ncomplicated."}),"\n",(0,i.jsx)(n.p,{children:"It starts from renting a virtual machine and setting the machine up, to running\nmy web servers in containers, setting DNS records, running Nginx and monitoring\ntools. All cost me on average less than $4 a month. Including the cost of\nrenting my own domain, it is still less than $5 per month on average."}),"\n",(0,i.jsx)(n.p,{children:"It gave me a lot of fun to tinker with things. It allows me to host more than 1\nweb server on the same machine using nginx. I would like to share the steps,\nthought process and learnings in details."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Last year, I created ",(0,i.jsx)(n.a,{href:"https://playground.ethanppl.com/",children:"my playground"}),". It is a\nweb server that power real time, turn-based multiplayer game. The major\ndifference it has with all the tools I built before was it needs a server.\nUnlike this Wiki, the content and service it provides are not static. It cannot\nbe hosted as a static site on GitHub Pages for free. To synchronize and power\nreal time multiplayer, I need a server on the Internet that is always up that\nclients can connect to."]}),"\n",(0,i.jsx)(n.h3,{id:"why-i-chose-self-hosting",children:"Why I chose self-hosting"}),"\n",(0,i.jsxs)(n.p,{children:["There are multiple ways to do this. With\n",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Platform_as_a_service",children:"platform as a service"})," or\nsimilar cloud services model, I could just use the right platform to host. It\nshould be easier to set up and configure, with less overhead and initial cost.\nHowever, because it is just a hobby project, the stakes are low. I think it is\nworth to figure out how to self-host."]}),"\n",(0,i.jsxs)(n.p,{children:["Self-hosting allows me to tinker with networking, containers, server management,\nand more. By having a machine running, it also opens the possibility to host\nmore than 1 web services on it. I started with hosting\n",(0,i.jsx)(n.a,{href:"https://playground.ethanppl.com/",children:"the playground server"}),", soon added my own\n",(0,i.jsx)(n.a,{href:"https://plausible.io/",children:"plausible analytics server"}),", an error tracking server\ncalled ",(0,i.jsx)(n.a,{href:"https://glitchtip.com/",children:"glitchtip"}),", and more. All running on this small\nmachine in the data center. There is no additional cost for each new server I\nadd to the server."]}),"\n",(0,i.jsx)(n.p,{children:"The server with just 2 vCPUs and 4 GB of RAM, with 20 TB traffic included, is\nable to power a lot of services. The server itself cost less than $4 a month.\nConsidering, Plausible cloud service cost $9 a month, and most cloud providers'\nweb services with much tinier machine still cost a few dollars a month.\nSelf-hosting is a great deal."}),"\n",(0,i.jsx)(n.p,{children:"This guide includes my notes and thought process while researching and setting\nup things. It started from purchasing my own domain. Then, researching and\ndeciding to rent a virtual machine from Hetzner, configure it and setting it up.\nRunning my web server in a container in the VM. All the configurations required\nto route traffic to the web server and finally monitoring tools for the server."}),"\n",(0,i.jsx)(n.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,i.jsx)(n.p,{children:"Before I go over the setup step by step, it would be great to go over the major\ncomponents in the setup and some terminologies so that we are aligned."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"architecture",src:t(5026).A+"",width:"1415",height:"485"})}),"\n",(0,i.jsxs)(n.p,{children:["When user request for ",(0,i.jsx)(n.code,{children:"playground.ethanppl.com"}),", what happens is your computer\nneed to know where that is hosted. It sends a domain name system (DNS) query to\nDNS servers to ask for the IP address for the ",(0,i.jsx)(n.code,{children:"playground.ethanppl.com"})," domain.\nOnce it gets the IP address, it sends a request to this IP address at port 80 to\nget the web page. This guide will go through how to configure and set up your\ndomain and DNS. For more about how the Internet work I suggest checking out\n",(0,i.jsx)(n.a,{href:"https://explained-from-first-principles.com/internet/",children:"The Internet, Explained from First Principle"}),"\nor other resources in the ",(0,i.jsx)(n.a,{href:"/computers/network/network",children:"Computer Network Page"})," in\nthis Wiki."]}),"\n",(0,i.jsx)(n.p,{children:'From here, the definition of the "server" can get a bit confusing. There are\nmultiple web servers supporting multiple services that can be run on the same\nserver machine. It is like your computer can run different apps, process,\nservers on the same machine. We can run multiple web servers on the same\nmachine.'}),"\n",(0,i.jsxs)(n.p,{children:["Requests coming from the Internet reach our IP address. The computer listening\nto these requests is the ",(0,i.jsx)(n.em,{children:"server"}),". I hosted this server on\n",(0,i.jsx)(n.a,{href:"https://www.hetzner.com/cloud/",children:"Hetzner"}),", a cloud provider providing cheap\nvirtual machines and the IP addresses. This virtual private server (VPS) is like\na normal computer that is accessible from the Internet. In this guide, I will\nrefer to this server as the virtual machine (VM), the server machine, or just\nthe Hetzner VPS. I will explain why I chose Hetzner and how to set it up below."]}),"\n",(0,i.jsxs)(n.p,{children:["Within the server machine, all incoming requests go through\n",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.a,{href:"https://nginx.org/en/",children:"nginx"})}),", a reverse proxy running natively on the\nvirtual machine. A\n",(0,i.jsx)(n.a,{href:"https://www.cloudflare.com/en-gb/learning/cdn/glossary/reverse-proxy/",children:"reverse proxy"}),"\nis like a server sitting in front of our real server, relaying messages between\nthe clients and the server. Nginx looks at what servers you are requesting, in\nthis case ",(0,i.jsx)(n.code,{children:"playground.ethanppl.com"}),", and route this to the corresponding service\nthat are handling these requests. Say another request is going to\n",(0,i.jsx)(n.code,{children:"plausible.ethanppl.com"}),", nginx will route this to a separate service. Nginx is\nthe magic that allow us to run multiple web services on the same server machine.\nIt is also responsible for supporting HTTP2, HTTP3 and HTTPS. All explained\nbelow."]}),"\n",(0,i.jsxs)(n.p,{children:["All the web services on the server are running in\n",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.a,{href:"https://www.docker.com/resources/what-container/",children:"containers"})}),'. It provides an\nisolated way to run these services without them intervening each other. The\ncontainers are the actual "web servers" that are providing the service. I will\nalso explain how I ran the database that the playground web server use in a\ncontainer, and how to set up docker volumes and network for this local database.']}),"\n",(0,i.jsx)(n.p,{children:"It is OK if all the terminologies sounds a lot. I will explain in details below.\nAll you need to be aware of right now is the difference between the server\nmachine and the web servers. I will first talk about the server machine hosted\non Hetzner, then how to run containers in the server machine, and lastly\nconfigure Nginx and wiring things up."}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Terminologies:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DNS"}),": translates domain name to IP address"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server machine"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A web server rent from Hetzner running in a data center in Finland"}),"\n",(0,i.jsx)(n.li,{children:"Also referenced as the Hetzner VPS, or the virtual machine"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"nginx"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A reverse proxy server in front of the real web server"}),"\n",(0,i.jsx)(n.li,{children:"Handle piping the traffic to the right server based on the domain requesting"}),"\n",(0,i.jsx)(n.li,{children:"Handle HTTPS, HTTP2 and HTTP3"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Containers"}),": the actual web servers"]}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"This blog turns out to be longer than I initially thought. However, I do not\nwant this to be intimidating for people who want to try self-hosting. Instead, I\nwould like to write down all my thought process and things I learned along the\nway to help anyone hesitate to start."}),"\n",(0,i.jsx)(n.p,{children:"This document is structured as if you were following along self-hosting your own\nPlayground server. There are notes for some key steps and concepts. I wish this\ndocument is something I could read beforehand, telling me self-hosting is not\nthat hard and not that expensive!"}),"\n",(0,i.jsx)(n.p,{children:"If you are ready, let's start from the first thing I did, getting a domain name."}),"\n",(0,i.jsx)(n.h2,{id:"register-a-domain",children:"Register a Domain"}),"\n",(0,i.jsxs)(n.p,{children:["When I decided to self-host my server, the first thing I did is to purchase my\nown ",(0,i.jsx)(n.code,{children:"ethanppl.com"})," domain. If you have a domain, you can skip forward to\n",(0,i.jsx)(n.a,{href:"#renting-a-hetzner-vps",children:"renting a Hetzner VPS"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Registering a domain technically is not related to self-hosting. It is not\nrequired to run a server. It is possible to directly connect to the server over\nthe Internet with IP address and port number. However, having a hostname is\neasier to visit, share, or get a certificate for HTTPS."}),"\n",(0,i.jsxs)(n.p,{children:["There are many domain registrars. I got mine from\n",(0,i.jsx)(n.a,{href:"https://www.cloudflare.com/en-gb/products/registrar/",children:"Cloudflare"}),". It is cheap\nand easy to set up. I got my domain for 2 years with less than 20 USD.\nCloudflare provides free whois protection, DNSSEC, email routing, etc. by\ndefault. I have heard that ",(0,i.jsx)(n.a,{href:"https://www.namecheap.com/",children:"Namecheap"})," and\n",(0,i.jsx)(n.a,{href:"https://porkbun.com/",children:"Porkbun"})," both works well with the developer community.\nYou can read\n",(0,i.jsx)(n.a,{href:"https://blog.pragmaticengineer.com/domain-registrars-which-developers-recommend/",children:"this article from the Pragmatic Engineer"}),"\nfor more."]}),"\n",(0,i.jsx)(n.h2,{id:"renting-a-hetzner-vps",children:"Renting a Hetzner VPS"}),"\n",(0,i.jsx)(n.p,{children:"To self-host, you need a server. The server is just a computer that runs 24\nhours and connected to the Internet."}),"\n",(0,i.jsx)(n.h3,{id:"where-to-host",children:"Where to host"}),"\n",(0,i.jsx)(n.p,{children:"You could use a machine you have or use a cloud provider. The difference is\nwhether you manage the physical metal machine, networking, electricity and\noperating system, or pay a cloud provider to handle that. I considered hosting\nwith a machine at home, but I chose to rent a VM from a cloud provider in the\nend."}),"\n",(0,i.jsxs)(n.p,{children:["I have an old laptop sitting next to me unused, or I could buy a\n",(0,i.jsx)(n.a,{href:"https://www.raspberrypi.org/",children:"Raspberry Pi"}),". The benefit is there will be no\nongoing cloud subscription fee to rent a VM. For a cheaper price, I get better\nperformance. It allows me to learn more, figure out more details and\nunderstanding more on bare metal operating systems and servers. The latency for\nme to connect to the service I host is also extremely low as it sits next to me."]}),"\n",(0,i.jsxs)(n.p,{children:["One of the bigger hurdles to use a machine at home is to ensure a stable IP\naddress for this machine to be reachable over the Internet. But for most home\naddress, the IP address might be dynamic, or go through\n",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Network_address_translation",children:"network address translation"}),"\nwhich makes it impossible to have a stable IP address. One possible solution is\n",(0,i.jsx)(n.a,{href:"https://github.com/ddclient/ddclient",children:"ddclient"}),", which periodically update the\nDNS record for you with the dynamically changing IP address. It works with all\nmajor DNS and domain registrars including Cloudflare, Namecheap and Porkbun."]}),"\n",(0,i.jsx)(n.p,{children:"Also, there are greater risk in terms of privacy and security concerns. If I\nmessed up, I am not exposing a VM in a datacenter but a computer in my home\nnetwork. It is also going to consume electricity and network bandwidth of my\nhome network. In the end, considering the risk and effort required, I decided to\nrent a cloud VM."}),"\n",(0,i.jsxs)(n.p,{children:["Out of all the options I can find online, the cheapest is renting a\n",(0,i.jsx)(n.a,{href:"https://www.hetzner.com/cloud/",children:"Hetzner VM"}),". I chose the cheapest model I can\nfind, CX22 machine in Helsinki, Finland. It provides 2 vCPUs, 4 GB of RAM, 40 GB\nof storage and 20 TB of bandwidth per month. The server and a IPv4 address\ncombined cost \u20ac3.79 each month. It is cheaper compare to all other providers\nwith the same specs, and it is more than what I need. With this, there are a lot\nI can do with it."]}),"\n",(0,i.jsx)(n.p,{children:"The biggest drawback for me is it is hosted in Finland, the roundtrip from Hong\nKong to Finland takes time. I searched online on the typical latency and also\ntested it after rending, it is around 0.1 to 0.3 seconds. It is definitely\nnoticeable, but not deal-breaking for me considering the price. Hetzner started\nto offer servers in Singapore, but with 2 to 3 times the price. I chose Finland\ninstead."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["If you would like to try Hetzner, here is my\n",(0,i.jsx)(n.a,{href:"https://hetzner.cloud/?ref=YMRI7xo3b2af",children:"referral link for hetzner"}),". You get\n$20 credits for free on sign up, while I get $10 after you spent $10. If you\nhave the same setup as me, this should get yours running 5 months for free."]})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Renting on Hetzner instead of local machine because:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Still very cheap"}),"\n",(0,i.jsx)(n.li,{children:"No need to handle problems with dynamic IP address"}),"\n",(0,i.jsx)(n.li,{children:"Lower privacy and security risk"}),"\n",(0,i.jsx)(n.li,{children:"Hardware maintenance is taken care by Hetzner"}),"\n",(0,i.jsx)(n.li,{children:"Electricity and network cost is also handled by Hetzner"}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"hetzner-server-setup",children:"Hetzner Server Setup"}),"\n",(0,i.jsxs)(n.p,{children:["If you decided to host on another cloud machine, similar set of settings should\napply. Make sure you can connect to it over SSH, and it is accessible over the\nInternet. After that, you may skip forward to\n",(0,i.jsx)(n.a,{href:"#ssh-connection",children:"SSH configuration tips"})," and\n",(0,i.jsx)(n.a,{href:"#running-the-web-server",children:"running the web server in Docker"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["To rent a Hetzner VPS, create an account in\n",(0,i.jsx)(n.a,{href:"https://hetzner.cloud/?ref=YMRI7xo3b2af",children:"Hetzner Cloud"}),". There might be a few\nverifications steps involved to prevent abuse. Once the account is active, you\ncan rent a server.\n",(0,i.jsx)(n.a,{href:"https://docs.hetzner.com/cloud/servers/getting-started/creating-a-server",children:"Hetzner has a comprehensive guide on how to create a server"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"I tried to keep my server specs closer to what I have on my laptop. I tried an\nArm chip at first, but there were minor inconveniences I faced because of\nslightly different versions, API or support on various stuff. It is frustrating\nbecause I know the issue, but I cannot reproduce and test the fix locally. In\nthe end, I went back to Amd x86 chip, same as my laptop used for development."}),"\n",(0,i.jsx)(n.p,{children:"My configuration are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Location: Helsinki","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"After considering latency and pricing, this works for me"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Image: Ubuntu","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Just because ",(0,i.jsx)(n.a,{href:"/blog/2024/02/29/dual-boot-guide",children:"I use Ubuntu locally"})," as well"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Typed: Shared CPU x86 (Intel/AMD)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"I am not doing intensive or sensitive stuff, shared CPU is fine"}),"\n",(0,i.jsx)(n.li,{children:"I chose x86 because I am running on an x86 laptop as well"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Networking: IPv4 and IPv6","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IPv4: My network is only IPv4, saves me a lot of hassle by having a IPv4"}),"\n",(0,i.jsx)(n.li,{children:"IPv6: It is free of charge so why not"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"SSH keys: Create a pair and save the keys locally, use later to SSH into the\nmachine"}),"\n",(0,i.jsx)(n.li,{children:"Volumes: No, I did not create one."}),"\n",(0,i.jsx)(n.li,{children:"Firewall: No, I did not create one."}),"\n",(0,i.jsx)(n.li,{children:"Backups: No, I did not enable it."}),"\n",(0,i.jsx)(n.li,{children:"Placement groups: No, irrelevant as I only have 1 server"}),"\n",(0,i.jsx)(n.li,{children:"Labels: Whatever you like, I did not add any as I only have 1 server"}),"\n",(0,i.jsx)(n.li,{children:"Cloud config: See below"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Cloud configuration is a set initialization configuration for newly created\nservers.\n",(0,i.jsx)(n.a,{href:"https://community.hetzner.com/tutorials/basic-cloud-config",children:"Hetzner Community has a guide for it"}),"\nand I used a very similar config."]}),"\n",(0,i.jsx)(n.p,{children:"The few important things it set up are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fail2ban"}),": To prevent brute force attacks on the SSH authentication"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ufw"}),": firewall to only allow required ports"]}),"\n",(0,i.jsx)(n.li,{children:"Harden SSH configs like deactivating password authentication"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"I suggest read the Hetzner guide and the manual for these programs. It is worth\nto understand the suggested security practice. Tweak it according to what you\nwould like. Remember to change the user's name to your name."}),"\n",(0,i.jsx)(n.h3,{id:"ssh-connection",children:"SSH Connection"}),"\n",(0,i.jsxs)(n.p,{children:["To connect to the server, you need to\n",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Secure_Shell",children:"SSH"})," into the machine. SSH provides\na way to connect your computer to the server computer with the terminal. It is\nlike directly accessing the terminal of the server over the Internet, securely.\n",(0,i.jsx)(n.a,{href:"https://docs.hetzner.com/cloud/servers/getting-started/connecting-to-the-server",children:"Hetzner documentation has a guide as well"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"To connect to a server, you run an ssh command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"ssh -i /path/to/private_key username@<ip_address>\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"-i"})," option for the identity file, provide the ssh private key file"]}),"\n",(0,i.jsx)(n.li,{children:"The username is the name set in the cloud init configuration above"}),"\n",(0,i.jsx)(n.li,{children:"The IP address is the address you rent, shown on the Hetzner dashboard"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If your cloud init config changed the port to ",(0,i.jsx)(n.code,{children:"2222"}),", then"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"ssh -i /path/to/private_key -p 2222 username@<ip_address>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For the first time, you will most likely be prompted if you want to connect to\nthe host. By default, confirming will save this host to ",(0,i.jsx)(n.code,{children:"~/.ssh/known_hosts"}),",\nand you will not see this warning again. Once successfully ran the command, you\nshould see output like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Welcome to Ubuntu 24.04 LTS (GNU/Linux 6.8.0-40-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n System information as of Sat Apr 19 03:35:28 PM UTC 2025\n\n  System load:  0.37               Processes:             223\n  Usage of /:   58.7% of 37.23GB   Users logged in:       0\n  Memory usage: 55%                IPv4 address for eth0: 100.100.100.100\n  Swap usage:   0%                 IPv6 address for eth0: aaaa:bbbb:cccc:dddd::1\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Running the command ",(0,i.jsx)(n.code,{children:"exit"})," or pressing ",(0,i.jsx)(n.code,{children:"Ctrl + D"})," will close the connection."]}),"\n",(0,i.jsxs)(n.p,{children:["There is one additional step I did to improve the workflow. Instead of typing\nout the command and IP address out every time, you can set up an SSH config in\n",(0,i.jsx)(n.code,{children:"~/.ssh/config"}),". Here is my config for my server:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Host playground\n  HostName 100.100.100.100\n  User ethan\n  IdentityFile ~/.ssh/hetzner_personal\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The host ",(0,i.jsx)(n.code,{children:"playground"})," can be any name you choose."]}),"\n",(0,i.jsx)(n.li,{children:"Hostname is the IP address of your server machine"}),"\n",(0,i.jsx)(n.li,{children:"User is the login username"}),"\n",(0,i.jsx)(n.li,{children:"Identity file is the file to the private key"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["With this configuration saved, connecting to the server is simply running\n",(0,i.jsx)(n.code,{children:"ssh playground"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Set up server"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Choose suitable architecture and OS"}),"\n",(0,i.jsx)(n.li,{children:"Basic firewall and SSH configurations for security measures"}),"\n",(0,i.jsxs)(n.li,{children:["Create an SSH config in ",(0,i.jsx)(n.code,{children:"~/.ssh/config"})," locally for easier access"]}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"running-the-web-server",children:"Running the Web Server"}),"\n",(0,i.jsxs)(n.p,{children:["With the server machine all set up, next is to run the playground web server and\nthe database on this machine. I chose running the app and the database in docker\nfor easier management. If you run it in other ways, you can skip this session,\nmake the app run on the server, and skip ahead to the\n",(0,i.jsx)(n.a,{href:"#configuring-dns",children:"configuring DNS"}),",\n",(0,i.jsxs)(n.a,{href:"#configure-firewall-ufw",children:["configuring firewall with ",(0,i.jsx)(n.code,{children:"ufw"})]}),", and\n",(0,i.jsxs)(n.a,{href:"#configure-reverse-proxy-server-nginx",children:["configuring reverse proxy server ",(0,i.jsx)(n.code,{children:"nginx"})]}),"\nsection."]}),"\n",(0,i.jsx)(n.h3,{id:"why-docker",children:"Why Docker?"}),"\n",(0,i.jsx)(n.p,{children:"There are several ways to run a server. You may run it as a process on the\nmachine directly. This should be the simplest to get started. You can even run\nthe server the same way as how you are running it locally. However, it will get\nharder when managing versions of the apps and getting the runtime right. For\nexample, my playground is an elixir server. If I want to update the Elixir or\nErlang version, I need to make sure the same version is properly installed on\nthe server machine as well. If I have another web server running on the same\nmachine that needs another version of Elixir then I need to install some other\nvirtual environment or shimming tools on the server as well. And if I ever want\nto have more than one machine running the same app, then I need to update every\nsingle machine to the same versions."}),"\n",(0,i.jsxs)(n.p,{children:["I am probably still far from all these scaling issues, but there is nothing\nstopping me from preemptively think about scaling issues. It gets harder to\nmanage when more things are involved, if there is no isolation. To solve all the\nabove issues, the most common solution is running apps in\n",(0,i.jsx)(n.a,{href:"https://www.docker.com/resources/what-container/",children:"containers"}),"."]}),"\n",(0,i.jsx)(n.p,{children:'If you do not know what containers are, you can think of them as a box that\nprovide a mini computer environment for the things running inside. And this box\nis completely isolated from other boxes or the world outside the box. The box is\nlightweight, which means it is easy to create, start, stop or destroy, with\nlower overhead compare to virtual machines. Furthermore, they are "standardized"\nlike shipping containers. The same containers can be run in different\nenvironment (Windows, Mac, Linux, etc.) with the docker engine installed. Any\ncode in any tech stack can be run within a container, just like any things can\nbe shipped on any cargo vessels, as long as they fit in the standardized\nshipping containers. It solves the issue where an app need to build a native\nversion for every runtime environment.'}),"\n",(0,i.jsx)(n.p,{children:"The overall flow for me to deploy playground right now is not very optimized,\nbut works for me. Plus, I do not deploy frequently. I will go through them in\ndetails below, but this is the higher level:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Push code to GitHub and tag the commit I want to deploy"}),"\n",(0,i.jsx)(n.li,{children:"Pull code from the Hetzner VPS and checkout the tag"}),"\n",(0,i.jsx)(n.li,{children:"Build a new image in the VPS"}),"\n",(0,i.jsx)(n.li,{children:"Stop and then remove the old container"}),"\n",(0,i.jsx)(n.li,{children:"Start the new container"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["There are other tools and services to allow easier deployment, like\n",(0,i.jsx)(n.a,{href:"https://coolify.io/",children:"Coolify"}),". You may find these useful if you are not\ncomfortable working with docker and nginx directly, or want to make the process\nmore optimize."]}),"\n",(0,i.jsx)(n.h3,{id:"pull-code",children:"Pull Code"}),"\n",(0,i.jsx)(n.p,{children:"First, I need to make sure my Hetzner VPS and my local machine have the same\ncode. And the easiest way for me to copy them over is to push that code to\nGitHub, then pull the same commit from GitHub."}),"\n",(0,i.jsx)(n.p,{children:"I chose not to use a docker repository, where I would need to first push a\ndocker image for the new version, and then pull that image and run it. I already\nhave a code repository. I can directly build the docker image with the source\ncode in the server machine. Because it is just docker build, I do not need any\nruntime and binary either. I only need to SSH into the VPS and run a script."}),"\n",(0,i.jsxs)(n.p,{children:["If you are able to push code to GitHub, I think you know how to pull code from\nGitHub. The only difference, maybe, is to get familiar with the git CLI, if you\nare used to Git with a GUI. The CLI is not that complicate for basic pull and\ncheckout. I have some more resources in the\n",(0,i.jsx)(n.a,{href:"https://wiki.ethanppl.com/computers/programming/git",children:"Git page of this Wiki"}),".\n",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent",children:"Generate a new pair of SSH keys"}),"\nin the Hetzner VM and add it to your GitHub account should make every thing\nworks."]}),"\n",(0,i.jsx)(n.h3,{id:"building-the-server-image",children:"Building the Server Image"}),"\n",(0,i.jsxs)(n.p,{children:["With Git set up, next is to install docker. Docker allow us to build the images\nand run those images in containers. There are detailed documentation on how to\ninstall docker, and\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/install/ubuntu/",children:"here is the one for Ubuntu"}),".\nOne thing to pay attention for Linux is there are\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/install/linux-postinstall/",children:"post-installation steps"}),"\nto manage user roles and permissions."]}),"\n",(0,i.jsxs)(n.p,{children:["To run the app in a container, we need to build an image for it to run on. A\ndocker image contains the code and data needed for the container to run. The\ninstructions for building a docker image are specified in a\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/reference/dockerfile/",children:"docker file"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["I will not go into the specific details of setting up the Elixir build\nenvironment and run time in this post, that will most likely be different from\nwhat you need if you are not running an Elixir app. You will need to write your\nown docker file or copy some templates for your tech stack. You can find the\n",(0,i.jsx)(n.a,{href:"https://github.com/ethanppl/playground/blob/main/Dockerfile",children:"docker file for my playground app in the GitHub repository"}),"\nfor reference."]}),"\n",(0,i.jsxs)(n.p,{children:["Docker image can be based on top of other docker images. For example,\n",(0,i.jsx)(n.a,{href:"https://hub.docker.com/_/alpine/",children:"alpine"})," is a lightweight Linux image to be\nbased on. Which image to use depends on what apps you are running, there should\nbe plenty of guides on how to build a docker image for the tech stack that you\nare running on. For the playground app, since we are running an Elixir app, the\nbase image is based on the\n",(0,i.jsx)(n.a,{href:"https://hub.docker.com/_/elixir",children:"elixir docker image"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"To test the docker file, you can build it locally and run the container locally\nto see if it works as expected. This is also why I set up my server environment\ncloser to my local machine. It is easier to build and debug the image locally,\nwhile having a higher likelihood all should still work on the server machine."}),"\n",(0,i.jsxs)(n.p,{children:["So, build the docker image at the root of the repository, where the ",(0,i.jsx)(n.code,{children:"Dockerfile"}),"\nis. I like to tag the output image (",(0,i.jsx)(n.code,{children:"-t playground"}),"), so it is easier to\nreference later:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker buildx build -t playground .\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Building a docker image for the web server"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Docker containers for isolation and easier deployment"}),"\n",(0,i.jsx)(n.li,{children:"Write and test building the docker image locally"}),"\n",(0,i.jsx)(n.li,{children:"Pull code from git and build the container image in the server machine"}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"running-the-postgres-container",children:"Running the Postgres Container"}),"\n",(0,i.jsx)(n.p,{children:"My server depends on a Postgres database. I ran this database also inside a\ncontainer, with docker volume and custom bridge network set up. If you do not\nneed a database, you may skip this section."}),"\n",(0,i.jsx)(n.p,{children:"Again, I can run the Postgres database natively or as a docker container. I\nchose running it in a docker container for the benefit of isolation. I knew I\nwill run other services on the same machine that also need separate Postgres\ndatabases. Having them isolated make things easier to control."}),"\n",(0,i.jsx)(n.p,{children:"Docker volumes and networking are the two important things to consider when\nrunning a database in a container."}),"\n",(0,i.jsx)(n.h4,{id:"docker-volume",children:"Docker Volume"}),"\n",(0,i.jsxs)(n.p,{children:["First, when the database container is stopped or destroyed, we want to persist\nits data. Otherwise, it's not a database.\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/storage/volumes/",children:"Docker volume"})," is a great way\nto do that. Volumes are managed by docker and the data will be preserved even\nthe container is stopped or destroyed. Volume is the preferred way to store and\nretrieve data in a container."]}),"\n",(0,i.jsx)(n.p,{children:"First, create a volume to be used later:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker volume create pgdata\n"})}),"\n",(0,i.jsx)(n.h4,{id:"docker-network",children:"Docker Network"}),"\n",(0,i.jsxs)(n.p,{children:["Second, as mentioned, containers are isolated. The playground app running in a\ncontainer by default cannot connect to the Postgres database running in another\ncontainer. There are generally two approaches to solve this issue, expose the\ncontainer to the host network or create a user-defined\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/network/",children:"docker network"})," to connect the two\ncontainers."]}),"\n",(0,i.jsxs)(n.p,{children:["Exposing to the host network means the container will share the host's network.\nFor example, if the Postgres container is exposing the 5432 port to the host\nnetwork, inside the machine, accessing ",(0,i.jsx)(n.code,{children:"localhost:5432"})," will be the docker\ncontainer. The advantage is this is easier to set up, just add the\n",(0,i.jsx)(n.code,{children:"--network=host"})," flag, but then there is no isolation. Generally, any process\nthat can access localhost will be able to access the localhost will be able to\naccess the container. It is also impossible for two different Postgres\ncontainers to share the same localhost 5432 port."]}),"\n",(0,i.jsxs)(n.p,{children:["On the other hand, docker allows creating user-defined network. The default\nnetwork driver is called\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/network/drivers/bridge/",children:"bridge network"}),". In\nsimple terms, defining a custom bridge network creates a bridge between the\ncontainers to communicate with each other. This solves what we need while\nmaintaining the same isolation. Containers can also be attached and detached\nfrom the bridge networks on the fly."]}),"\n",(0,i.jsx)(n.p,{children:"To create a network to be used later:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker network create playgroundNetwork\n"})}),"\n",(0,i.jsx)(n.h4,{id:"running-the-database",children:"Running the Database"}),"\n",(0,i.jsx)(n.p,{children:"It takes one line to run the Postgres container"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker run\n  --name postgres\n  --env=POSTGRES_PASSWORD=ReplaceMe\n  --env=POSTGRES_DB=playground_engine\n  -v pgdata:/var/lib/postgresql/data\n  -p 5432:5432\n  -d\n  postgres\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/reference/cli/docker/container/run/#name",children:"name"}),"\nof the container will be ",(0,i.jsx)(n.code,{children:"postgres"})]}),"\n",(0,i.jsxs)(n.li,{children:["The two\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/reference/cli/docker/container/run/#env",children:"ENV variables"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The password for the superuser ",(0,i.jsx)(n.code,{children:"postgres"})]}),"\n",(0,i.jsx)(n.li,{children:"The default database name"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://hub.docker.com/_/postgres/",children:"There are more ENV variables available to configure"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Use the ",(0,i.jsx)(n.code,{children:"pgdata"})," volume created earlier and mount that to the\n",(0,i.jsx)(n.code,{children:"/var/lib/postgresql/data"})," path inside the container"]}),"\n",(0,i.jsx)(n.li,{children:"Expose 5432 port to the network"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-d"})," to\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/reference/cli/docker/container/run/#detach",children:"detach"}),"\nthe container process from the terminal window, otherwise closing the terminal\nwill stop the container"]}),"\n",(0,i.jsxs)(n.li,{children:["And finally ",(0,i.jsx)(n.code,{children:"postgres"})," is the name of the image, which\n",(0,i.jsx)(n.a,{href:"https://hub.docker.com/_/postgres/",children:"you can find on docker hub"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"verify-the-database-is-running",children:"Verify the Database is Running"}),"\n",(0,i.jsxs)(n.p,{children:["Once connected, we can use ",(0,i.jsx)(n.code,{children:"psql"})," to verify the database is up and running."]}),"\n",(0,i.jsxs)(n.p,{children:["Most likely, the base Ubuntu image does not come with ",(0,i.jsx)(n.code,{children:"psql"}),", so it needs to be\ninstalled:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo apt install -y postgresql-client-common postgresql-client-16\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then connecting to it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"psql postgresql://postgres@localhost:5432/playground_engine\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You will be prompted to input your password. Input the same password set above\nin the ",(0,i.jsx)(n.code,{children:"POSTGRES_PASSWORD"})," ENV variable. If connected successfully, it means the\ndatabase is running well."]}),"\n",(0,i.jsxs)(n.p,{children:["In my\n",(0,i.jsx)(n.a,{href:"https://github.com/ethanppl/playground/blob/main/DEPLOYMENT.md",children:"playground deployment notes"}),",\nyou will find lines where I set up DB roles and privileges. They are just\npractices. Normally for a side project database there is no such need either. I\nmainly referenced\n",(0,i.jsx)(n.a,{href:"https://rlopzc.com/posts/securing-your-postgresql-db-with-roles--privileges/",children:"Securing your PostgreSQL DB with Roles & Privileges"}),"\nto build these commands for creating roles and granting privileges."]}),"\n",(0,i.jsxs)(n.p,{children:["With all that set, exit the ",(0,i.jsx)(n.code,{children:"psql"})," session and back to the host machine, we add\nthe Postgres container to the network created earlier:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker network connect playgroundNetwork postgres\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then, inspect the network to get the IP address of the Postgres container."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker network inspect playgroundNetwork\n"})}),"\n",(0,i.jsx)(n.p,{children:"There should be something like 127.18.0.2. Save it. It will be useful later to\nconnect the playground container to the database."}),"\n",(0,i.jsx)(n.h3,{id:"running-the-server-container",children:"Running the Server Container"}),"\n",(0,i.jsxs)(n.p,{children:["Then, we can deploy the Playground container. There are playground specific\ncommands that is used because of Elixir Phoenix framework. Your server with a\ndifferent tech stack will most likely require different ENVs. For example,\nPhoenix framework provide a\n",(0,i.jsx)(n.a,{href:"https://hexdocs.pm/phoenix/deployment.html",children:"deployment guide"}),". You may be able\nto find similar documentation."]}),"\n",(0,i.jsx)(n.p,{children:"For playground, this docker run command is used:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'docker run --name playground \\\n  --network=playgroundNetwork \\\n  --env=DATABASE_URL="postgresql://playground_backend:password@172.18.0.2:5432/playground_engine" \\\n  --env=MIGRATION_DATABASE_URL="postgresql://playground_migrations:password@172.18.0.2:5432/playground_engine" \\\n  --env=SECRET_KEY_BASE="secret" \\\n  --env=PHX_HOST="playground.ethanppl.com" \\\n  --env=ENV="production" \\\n  --env=SENTRY_DSN="https://sentry.ethanppl.com" \\\n  -p 4000:4000 \\\n  -d\n  playground\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Name this container as ",(0,i.jsx)(n.code,{children:"playground"})]}),"\n",(0,i.jsxs)(n.li,{children:["The network is the ",(0,i.jsx)(n.code,{children:"playgroundNetwork"})," created earlier"]}),"\n",(0,i.jsx)(n.li,{children:"Change the database role, password, IP address, and database name accordingly"}),"\n",(0,i.jsxs)(n.li,{children:["I have a separate role and user for schema migration, so a different\n",(0,i.jsx)(n.code,{children:"MIGRATION_DATABASE_URL"})]}),"\n",(0,i.jsxs)(n.li,{children:["Set the ",(0,i.jsx)(n.code,{children:"SECRET_KEY_BASE"})," to a secret generated from ",(0,i.jsx)(n.code,{children:"mix phx.gen.secret"})]}),"\n",(0,i.jsxs)(n.li,{children:["Set the ",(0,i.jsx)(n.code,{children:"PHX_HOST"})," to the domain name being used"]}),"\n",(0,i.jsxs)(n.li,{children:["Set the ",(0,i.jsx)(n.code,{children:"ENV"})," to production"]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"SENTRY_DSN"})," is optional to track errors"]}),"\n",(0,i.jsx)(n.li,{children:"Expose port 4000"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-d"})," to detach the process"]}),"\n",(0,i.jsxs)(n.li,{children:["Run the ",(0,i.jsx)(n.code,{children:"playground"})," image"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Once ran, you should be able to confirm the container is running with"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker ps\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should be able to see the playground container is up and running."}),"\n",(0,i.jsx)(n.p,{children:"Check the logs in the container to confirm it can connect to the database:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"docker logs playground\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If the app cannot connect to the database, double-check the IP address and port.\nAs a tip, you can spin up a small container with the\n",(0,i.jsxs)(n.a,{href:"https://hub.docker.com/_/alpine/",children:[(0,i.jsx)(n.code,{children:"alpine"})," image"]}),", add this small container to\nthe same network with the database, and you can use\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/reference/cli/docker/container/exec/",children:(0,i.jsx)(n.code,{children:"docker exec"})})," to\ndebug and see if it can connect to the database in the network. If it works,\nthen the database and docker network is working, it's the configuration or the\nplayground server problem. If it does not, then maybe the database is not\nrunning, or the docker bridge network is not working."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Getting everything running in docker:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Also run the Postgres database in container"}),"\n",(0,i.jsx)(n.li,{children:"Use docker volume to persist the database storage"}),"\n",(0,i.jsx)(n.li,{children:"Use docker network to allow connections between the web server container and\nthe database container"}),"\n",(0,i.jsx)(n.li,{children:"Run the container with the right environment variables"}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"configuring-dns",children:"Configuring DNS"}),"\n",(0,i.jsxs)(n.p,{children:["Domain name system (DNS) allows anyone on the Internet to use\n",(0,i.jsx)(n.code,{children:"playground.ethanppl.com"})," to find the IP address of the server hosting it, and\nroute request there."]}),"\n",(0,i.jsxs)(n.p,{children:["I used Cloudflare to purchase my ",(0,i.jsx)(n.code,{children:"ethanppl.com"})," domain, so logically I use their\nDNS service. Their DNS service is free of charge."]}),"\n",(0,i.jsxs)(n.p,{children:["To point ",(0,i.jsx)(n.code,{children:"playground.ethanppl.com"})," to the Hetzner VPS, we will need to set up an\n",(0,i.jsx)(n.code,{children:"A"})," record for the IPv4 address and an ",(0,i.jsx)(n.code,{children:"AAAA"})," record for the IPv6 address. The\nname of both records is ",(0,i.jsx)(n.code,{children:"playground"}),". The content is the IPv4 and IPv6 address,\nrespectively. I set the proxy status to true for both, but false also works.\nKeep the time to live (TTL) as auto, which by default is 5 minutes."]}),"\n",(0,i.jsxs)(n.p,{children:["If proxy is enabled, Cloudflare will expose their server IP address, and\ninternally route traffic to the Hetzner VPS. It automatically offers some\noptimization, caching and protection. Read more in\n",(0,i.jsx)(n.a,{href:"https://developers.cloudflare.com/dns/proxy-status/",children:"Cloudflare documentation"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Cloudflare DNS",src:t(8148).A+"",width:"1284",height:"387"})}),"\n",(0,i.jsxs)(n.p,{children:['Later, we will require HTTPS for the domain. If proxy is enabled, we need to\nchange the encryption mode from "Flexible" to "Full" or "Full (Strict)" in the\nSSL/TLS page. By default, Cloudflare use "Flexible" mode which send request in\nHTTP. If the server automatically redirects HTTP request to HTTPS requests, and\nCloudflare forward that request as HTTP, creating an infinite redirect loop.\nChange the encryption mode so that Cloudflare send request as HTTPS. Read more\nabout this problem in\n',(0,i.jsx)(n.a,{href:"https://developers.cloudflare.com/ssl/troubleshooting/too-many-redirects/#flexible-encryption-mode",children:"Cloudflare documentation"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"DNS:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"A"})," record for IPv4 and ",(0,i.jsx)(n.code,{children:"AAAA"})," for IPv6"]}),"\n",(0,i.jsx)(n.li,{children:'If proxy with Cloudflare and requiring HTTPS later, change encryption mode in\nCloudflare to "Full" or "Full (Strict)"'}),"\n"]})]}),"\n",(0,i.jsxs)(n.h2,{id:"configure-firewall-ufw",children:["Configure firewall (",(0,i.jsx)(n.code,{children:"ufw"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"With DNS set up, we can configure the server to listen to the traffic from the\nInternet."}),"\n",(0,i.jsxs)(n.p,{children:["Check the firewall setting in ",(0,i.jsx)(n.code,{children:"ufw"})," to make sure our app can listen to web\nserver traffic."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo ufw status\n"})}),"\n",(0,i.jsx)(n.p,{children:"Some of the commands that might be helpful"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw show user-rules"}),": display information of the running firewall"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw status verbose"}),": show config"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw enable"}),": enable ufw"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw default deny incoming"}),": by default disallow all incoming traffic\nfrom the Internet to the machine"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw default allow outgoing"}),": by default allow all outgoing traffic from\nthe machine to the Internet"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw allow OpenSSH"}),": allow SSH, ",(0,i.jsx)(n.strong,{children:"this is important"}),", otherwise will not\nbe able to SSH in"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw allow http"}),": allow HTTP"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw allow https"}),": allow HTTPS"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw allow in on docker0 from 192.168.1.0/24"}),": open ufw to docker for\nlocal network"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw allow in on docker0 from 10.8.0.0/24"}),": open ufw to docker for local\nnetwork"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw allow in on docker0 from 172.20.0.0/16"}),": open ufw to docker for\nlocal docker subnet"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sudo ufw allow 51820/udp"}),": allow UDP on port 51820 (this is not useful for\nplayground but for the wireguard server I have)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Here is the configuration I have"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"To                         Action      From\n--                         ------      ----\nOpenSSH                    ALLOW       Anywhere\n80/tcp                     ALLOW       Anywhere\n443                        ALLOW       Anywhere\nAnywhere on docker0        ALLOW       192.168.1.0/24\nAnywhere on docker0        ALLOW       10.8.0.0/24\nAnywhere on docker0        ALLOW       172.20.0.0/16\n51820/udp                  ALLOW       Anywhere\nOpenSSH (v6)               ALLOW       Anywhere (v6)\n80/tcp (v6)                ALLOW       Anywhere (v6)\n443 (v6)                   ALLOW       Anywhere (v6)\n51820/udp (v6)             ALLOW       Anywhere (v6)\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Firewall"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Allow SSH and HTTP connections"}),"\n",(0,i.jsx)(n.li,{children:"Disallow traffic into other ports"}),"\n"]})]}),"\n",(0,i.jsxs)(n.h2,{id:"configure-reverse-proxy-server-nginx",children:["Configure reverse proxy server (",(0,i.jsx)(n.code,{children:"nginx"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Nginx is a lightweight server running on the machine. It makes it easy to host\nmultiple domains on the same server. It can route the incoming traffic from the\nInternet to the right server running on the machine based on the domain name.\nFor example, anyone on the internet trying to talk to ",(0,i.jsx)(n.code,{children:"playground.ethanppl.com"}),"\nwill be routed to the docker container running at port ",(0,i.jsx)(n.code,{children:"4000"})," locally."]}),"\n",(0,i.jsxs)(n.p,{children:["There are a lot more features supported by nginx, you may explore them on\n",(0,i.jsx)(n.a,{href:"https://nginx.org/en/docs/",children:"their documentation"}),". The first thing is to get it\nup and running."]}),"\n",(0,i.jsx)(n.h3,{id:"basics",children:"Basics"}),"\n",(0,i.jsxs)(n.p,{children:["Install nginx first.\n",(0,i.jsx)(n.a,{href:"https://nginx.org/en/linux_packages.html#Ubuntu",children:"Here is the doc for installing on Ubuntu"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Start the nginx server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo systemctl start nginx\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The configurations are stored in the ",(0,i.jsx)(n.code,{children:"/etc/nginx"})," directory."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"cd /etc/nginx\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You should find a ",(0,i.jsx)(n.code,{children:"/etc/nginx/nginx.conf"})," file with some default configurations."]}),"\n",(0,i.jsxs)(n.p,{children:["You may add new configurations in the ",(0,i.jsx)(n.code,{children:"nginx.conf"})," file directly to test. But\nfor better organization, I find it better to create a separate config file for\neach server and include them in the main ",(0,i.jsx)(n.code,{children:"nginx.conf"}),". For me, the default\nconfiguration already includes a line of ",(0,i.jsx)(n.code,{children:"include /etc/nginx/conf.d/*.conf;"})," in\nthe ",(0,i.jsx)(n.code,{children:"http"})," block. Adding a new ",(0,i.jsx)(n.code,{children:"*.conf"})," file inside the ",(0,i.jsx)(n.code,{children:"/etc/nginx/conf.d"}),"\ndirectory will work."]}),"\n",(0,i.jsxs)(n.p,{children:["Create a new file ",(0,i.jsx)(n.code,{children:"playground.conf"})," file in ",(0,i.jsx)(n.code,{children:"/etc/nginx/conf.d"}),". The file name\ndoes not matter, you can change it however you want."]}),"\n",(0,i.jsx)(n.p,{children:"Add the following config:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'server {\n   listen 80;\n\n   # Change this\n   server_name playground.ethanppl.com;\n\n   location / {\n      proxy_pass http://localhost:4000;\n      proxy_ssl_server_name on;\n\n      # For web socket connections\n      proxy_http_version 1.1;\n      proxy_set_header Upgrade $http_upgrade;\n      proxy_set_header Connection "Upgrade";\n   }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Change the ",(0,i.jsx)(n.code,{children:"server_name"})," directive to the domain name of your web server. The\n",(0,i.jsx)(n.code,{children:"server_name"})," directive is what nginx use to determine where to route the\ntraffic. In the above configuration, anything requesting to\n",(0,i.jsx)(n.code,{children:"playground.ethanppl.com"})," will go to ",(0,i.jsx)(n.code,{children:"localhost:4000"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you are running the playground server, or anything requires web socket, the\nthree lines for setting header and connection upgrade is required. It allows\nupgrading an HTTP connection to a WebSocket connection. Read more about it in\n",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Upgrade",children:"MDN docs"}),"\nand explanation on setting up\n",(0,i.jsx)(n.a,{href:"https://nginx.org/en/docs/http/websocket.html",children:"WebSocket proxying in nginx"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"If your site contains requirements for other communication protocol, worth\nchecking nginx documentation to see if there are specific configurations needed.\nIt is also a good way to learn how protocols run behind the scenes and what are\ninvolved underlying the connections."}),"\n",(0,i.jsx)(n.p,{children:"Then, test that the nginx configurations are valid."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo nginx -t\n"})}),"\n",(0,i.jsx)(n.p,{children:"If all goes well, you should see the following lines being printed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n"})}),"\n",(0,i.jsx)(n.p,{children:"Otherwise, follow the instructions printed to fix the configuration. It should\ntell you where are the invalid value on which directive."}),"\n",(0,i.jsx)(n.p,{children:"Once all good, reload the nginx server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo nginx -s reload\n"})}),"\n",(0,i.jsx)(n.h3,{id:"https",children:"HTTPS"}),"\n",(0,i.jsx)(n.p,{children:'HTTPS is almost compulsory nowadays. Some default browser settings would prevent\nusers from accessing a site without HTTPS. I would like to share my site with\npeople without them clicking "Proceed (unsafe)". Able to set up HTTPS for\nself-hosted site is a must for me.'}),"\n",(0,i.jsxs)(n.p,{children:["Fortunately, there are free service providing signing and issuing certificate\nfor HTTPS. ",(0,i.jsx)(n.a,{href:"https://letsencrypt.org/",children:"Let's Encrypt"})," is a free certificate\nauthority service by a nonprofit organization. In fact, some major static site\nhosting on cloud providers like Render all uses Let's Encrypt behind the scene\nto provide their automated SSL certificates."]}),"\n",(0,i.jsxs)(n.p,{children:["Setting up the certificates are pretty easy.\n",(0,i.jsx)(n.a,{href:"https://certbot.eff.org/instructions?ws=nginx&os=ubuntufocal",children:"Here is the guide"}),"\nfor using nginx on Ubuntu with Certbot. ",(0,i.jsx)(n.a,{href:"https://certbot.eff.org/",children:"Certbot"})," can\nget free certificates and set the corresponding nginx configurations\nautomatically."]}),"\n",(0,i.jsxs)(n.p,{children:["For other platforms and setup, check\n",(0,i.jsx)(n.a,{href:"https://letsencrypt.org/getting-started/",children:"Let's Encrypt Getting Started documentation"}),"\nand ",(0,i.jsx)(n.a,{href:"https://certbot.eff.org/pages/help",children:"Certbot help page"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Follow the instructions to install snap and use snap to install certbot. Run\ncertbot and allow it to edit the nginx configurations directly."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo certbot --nginx\n"})}),"\n",(0,i.jsxs)(n.p,{children:["It will automatically find all the domains without certificates, create a\ncertificate and update the nginx configuration accordingly. Certbot provides a\n",(0,i.jsx)(n.code,{children:"certonly"})," option to let you make the nginx configurations by hand. But in my\nexperience, the bot is good, and it does not mess up the nginx configurations."]}),"\n",(0,i.jsxs)(n.p,{children:["Test that the configurations are all good: ",(0,i.jsx)(n.code,{children:"sudo nginx -t"}),". And reload the\nconfigurations again, ",(0,i.jsx)(n.code,{children:"sudo nginx -s reload"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Now you should be able to connect to the site with HTTPS!"}),"\n",(0,i.jsxs)(n.p,{children:["If you inspect the configuration file, you will see that lines marked with\n",(0,i.jsx)(n.code,{children:"# managed by Certbot"}),". It added port 443 for SSL connection, added the\n",(0,i.jsx)(n.code,{children:"ssl_certificate"})," directive and some related configurations. It also added an\nautomatic redirect from HTTP to HTTPS. This is why we need to tell Cloudflare to\nsend request with HTTPS when proxy through Cloudflare. Otherwise, it enters a\nredirect loop."]}),"\n",(0,i.jsx)(n.h3,{id:"http2-and-http3",children:"HTTP2 and HTTP3"}),"\n",(0,i.jsxs)(n.p,{children:["HTTP2 and HTTP3 each has improvements over the application protocol to improve\nlatency and reliability. Most of the time there should not be noticeable\ndifference, especially our site is not demanding high bandwidth communication.\nYou read more about HTTP2 and HTTP3 on the\n",(0,i.jsx)(n.a,{href:"/computers/network/http",children:"HTTP Page in this Wiki"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"To enable HTTP2,"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"http2 on"})," in the server configuration"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To enable HTTP3,"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"http3 on"})]}),"\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"listen 443 quic reuseport"})," or just ",(0,i.jsx)(n.code,{children:"listen 443 quic"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Notice that if there are multiple servers using the same IP address and port\nin nginx, only one of them can do ",(0,i.jsx)(n.code,{children:"reuseport"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"add_header Alt-Svc 'h3=\":443\"; ma=86400'"})," in the location block","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This is a response header to let the browser know that another location\n(alternative service (Alt-Svc)) is available for servicing with HTTP3 (h3)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The port used by ",(0,i.jsx)(n.code,{children:"quic"})," is recommended to be the same as ",(0,i.jsx)(n.code,{children:"ssl"}),", hence 443"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The final configuration should look something like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'server {\n   server_name  playground.ethanppl.com;\n\n   http2 on;\n   http3 on;\n\n   location / {\n      proxy_pass http://localhost:4000;\n      proxy_ssl_server_name on;\n\n      # For web socket connections\n      proxy_http_version 1.1;\n      proxy_set_header Upgrade $http_upgrade;\n      proxy_set_header Connection "Upgrade";\n\n      add_header Alt-Svc \'h3=":443"; ma=86400\';\n   }\n\n   listen 443 ssl; # managed by Certbot\n   listen 443 quic reuseport;\n\n   ssl_certificate /etc/letsencrypt/live/playground.ethanppl.com/fullchain.pem; # managed by Certbot\n   ssl_certificate_key /etc/letsencrypt/live/playground.ethanppl.com/privkey.pem; # managed by Certbot\n   include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n\n}\n\nserver {\n   if ($host = playground.ethanppl.com) {\n      return 301 https://$host$request_uri;\n   } # managed by Certbot\n\n\n   listen       80;\n   server_name  playground.ethanppl.com;\n   return 404; # managed by Certbot\n}\n'})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Nginx"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Based on the ",(0,i.jsx)(n.code,{children:"server_name"}),", proxy the connection to the docker container"]}),"\n",(0,i.jsx)(n.li,{children:"Use Let's Encrypt and certbot to get a certificate and configure HTTPS\nautomatically"}),"\n",(0,i.jsx)(n.li,{children:"Add relevant configuration to support HTTP2 and HTTP3 connections"}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,i.jsx)(n.p,{children:"I am not running mission-critical life savings web services, but it is still\ngood to monitor what is going on in the server and alert me when things gone\nwrong. I found some monitoring services online that are free for hobby projects."}),"\n",(0,i.jsx)(n.h3,{id:"netdata",children:"Netdata"}),"\n",(0,i.jsxs)(n.p,{children:["I use ",(0,i.jsx)(n.a,{href:"https://www.netdata.cloud/",children:"Netdata"})," for monitoring the Hetzner server\nand the containers. It has an agent to read the data and optionally upload to\nNetdata cloud server for some nice visualizations. It includes basics like CPU,\nmemory, storage and network data for the host machine. Additionally, it can also\nshow the load for each container running in the machine."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Netdata System Overview",src:t(9712).A+"",width:"1517",height:"495"}),"\n",(0,i.jsx)(n.img,{alt:"Netdata Containers Metrics",src:t(345).A+"",width:"1517",height:"487"})]}),"\n",(0,i.jsx)(n.p,{children:"It works out of the box. Create an account on Netdata Cloud, follow the prompt\nto connect a node, pick Ubuntu and follow the instructions on screen to install\nthe Netdata agent and all graphs worked. Email automations are automatically\nconfigured to notify when things went wrong. However, configuring the\nnotifications rules requires subscribing to a paid plan."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["If you would like to subscribe to Netdata, here is my\n",(0,i.jsx)(n.a,{href:"https://netdata.cello.so/m3g8ZJvzrI9",children:"invite link"})," for 10% discount for the\nfirst year."]})}),"\n",(0,i.jsx)(n.h3,{id:"checkly",children:"Checkly"}),"\n",(0,i.jsxs)(n.p,{children:["Another tool I used for checking uptime and response time is\n",(0,i.jsx)(n.a,{href:"https://www.checklyhq.com/",children:"Checkly"}),". For free, there is a certain amount of\nAPI calls and browser per month. What I do is just for every 30 mins to 1 hour,\ncall my self-hosted services and make sure they return status 200."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Checkly",src:t(7926).A+"",width:"1003",height:"403"})}),"\n",(0,i.jsx)(n.p,{children:"Checkly supports different location and interval to send the request. It also\nallows different assertions like text/json response, and verify the response\nmeet certain requirements. I kept it simple to assert for status 200, but there\nare potential to configure it for more robust health checks."}),"\n",(0,i.jsx)(n.h2,{id:"much-more",children:"Much More"}),"\n",(0,i.jsxs)(n.p,{children:["Other than monitoring, there are a lot more to try and experiment. I added my\nown ",(0,i.jsx)(n.a,{href:"https://plausible.io/",children:"plausible analytics server"}),",\n",(0,i.jsx)(n.a,{href:"https://glitchtip.com/",children:"glitchtip"})," error tracking server, and more. This blog\nis already long. I may write about them in the future. All in all, the machine\nis yours, and you can do whatever you want with it."]}),"\n",(0,i.jsxs)(n.p,{children:["There are more to explore in the area of self-hosting. There are always more to\ndo with security. This blog covered the basics like SSH authentication with keys\ninstead of password, basic firewall set up with ",(0,i.jsx)(n.code,{children:"ufw"})," and HTTPS for our server.\nThere are more to do like not SSH into as root user by default and running\ncontainers in rootless environment."]}),"\n",(0,i.jsxs)(n.p,{children:["Backup is also another important aspect for self-hosting. If you want to store\nanything important, always backup regularly. Follow the\n",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Backup#3-2-1_Backup_Rule",children:"3-2-1 backup rule"}),",\nwith 3 copies, 2 on different media types and 1 stored offsite. This is to\nprevent any potential catastrophic error, be it human error, or disk corrupted,\nelectricity disruption, virus and malware."]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"This setup has been running for 9 months now, and it requires little\nmaintenance. I had a lot of fun running my own server and figuring out stuff\nalong the way."}),"\n",(0,i.jsx)(n.p,{children:"This blog went through my thought process on choosing the server machine,\nrunning playground in docker, configuring database containers, DNS, nginx,\nfirewall and monitoring tools. I believe it will be a never ending journey and I\nhope this inspires people to try too. I am not someone particularly interested\nin DevOps or server configurations, but this project gave me a better\nunderstanding of the problem space."}),"\n",(0,i.jsxs)(n.p,{children:["If you would like to explore more,\n",(0,i.jsx)(n.a,{href:"https://github.com/awesome-selfhosted/awesome-selfhosted",children:(0,i.jsx)(n.code,{children:"awesome-selfhosted"})}),"\nis a list of software services available for hosting, and\n",(0,i.jsx)(n.a,{href:"https://github.com/awesome-foss/awesome-sysadmin",children:(0,i.jsx)(n.code,{children:"awesome-sysadmin"})})," is a list\nof awesome open-source sysadmin resources."]}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.p,{children:["Checkout ",(0,i.jsx)(n.a,{href:"/computers/self-hosting",children:"self-hosting page"})," for more."]}),"\n",(0,i.jsx)(n.p,{children:"My setup is closest to this blog:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://cprimozic.net/blog/my-selfhosted-websites-architecture/",children:"My self-hosted websites architecture"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"OVH cloud, nginx reverse proxy, DNS & networking, external CDN for high\ntraffic static sites"}),"\n",(0,i.jsx)(n.li,{children:"Hosting websites, databases, plausible for analytics, sentry for error\nalerts, personal utils"}),"\n",(0,i.jsx)(n.li,{children:"Handling security, monitoring, backup and disaster recovery"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Other blogs:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://grifel.dev/decentralization/",children:"Self-hosting in 2023"}),"\n(",(0,i.jsx)(n.a,{href:"https://news.ycombinator.com/item?id=34860655",children:"HN"}),")","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Interesting read. Self-host a blog with Raspberry Pi, Coolify for deployment\nand DDClient to solve the problem of a dynamic IP"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://pixeljets.com/blog/self-hosted-is-awesome/",children:"Self-hosted is awesome"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Hetzner setup, docker applications, nginx host, cloudflare DNS"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://jakew.me/home-server/",children:"Repurpose your old laptop into a home server"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ubuntu server, install docker, run Plex and secure remote connection with\ntailscale"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Other resources:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/awesome-selfhosted/awesome-selfhosted",children:"awesome-selfhosted"}),"\n\u2014 List of web applications that can be self-hosted"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/awesome-foss/awesome-sysadmin",children:"awesome-sysadmin"})," \u2014 List of\nsysadmin resources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.reddit.com/r/selfhosted/",children:"r/selfhosted"}),",\n",(0,i.jsx)(n.a,{href:"https://www.reddit.com/r/HomeServer/",children:"r/HomeServer"})," \u2014 Reddit sub"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://selfh.st/",children:"slefh.st"})," \u2014 Newsletter"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},5026:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/architecture-546e0402b35561fc00c2c6692f84a92f.png"},7926:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/checkly-b86ec2cfb7a9f85a2adf582ec49c9a90.png"},8148:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/cloudflare-dns-58058872de1e78e06b4ce83cfcf9f880.png"},345:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/netdata-containers-75a970d1a187422f08c8fa79adc609f3.png"},9712:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/netdata-overview-81f6550ce791712e4b18b990e4ae97bc.png"},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(6540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},7349:e=>{e.exports=JSON.parse('{"permalink":"/blog/2025/05/25/self-host","source":"@site/blog/2025-05-25-self-host.md","title":"My $4/month self-hosted web server setup","description":"This blog documented my setup for self-hosting a web server. Hopefully this is","date":"2025-05-25T00:00:00.000Z","tags":[{"inline":true,"label":"Computers","permalink":"/blog/tags/computers"},{"inline":true,"label":"Self Hosting","permalink":"/blog/tags/self-host"}],"readingTime":38.81,"hasTruncateMarker":true,"authors":[{"name":"Ethan Pang","url":"https://ethanppl.com/","imageURL":"https://github.com/ethanppl.png","key":"ethan","page":null}],"frontMatter":{"title":"My $4/month self-hosted web server setup","tags":[{"label":"Computers","permalink":"computers"},{"label":"Self Hosting","permalink":"self-host"}],"toc_min_heading_level":2,"toc_max_heading_level":2,"authors":"ethan"},"unlisted":false,"nextItem":{"title":"Reimplement all JavaScript Array Functions with while loops only","permalink":"/blog/2025/02/23/js-array"}}')}}]);